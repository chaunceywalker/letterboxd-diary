<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Letterboxd Diary</title>

<style>
body {
  margin:0;
  background:#14181c;
  font-family:-apple-system,BlinkMacSystemFont,sans-serif;
  color:white;
}

.container {
  padding:20px;
}

.entry {
  display:flex;
  gap:16px;
  padding:14px 0;
  border-bottom:1px solid #2c3440;
  align-items:flex-start;
}

.poster {
  width:70px;
  border-radius:6px;
  flex-shrink:0;
}

.details {
  flex:1;
}

.title {
  font-weight:600;
}

.meta {
  font-size:13px;
  color:#9ab;
  margin-top:4px;
}

.rating {
  color:#00e054;
  margin-top:6px;
  font-size:14px;
}
</style>
</head>

<body>
<div class="container" id="diary"></div>

<script>
const username = "chaunceywalker";

// Use a CORS proxy to fetch the diary page
fetch(`https://corsproxy.io/?https://letterboxd.com/${username}/films/diary/`)
  .then(res => res.text())
  .then(html => {
    const parser = new DOMParser();
    const doc = parser.parseFromString(html, "text/html");

    // Select each diary entry
    const rows = doc.querySelectorAll("li.diary-entry");

    const container = document.getElementById("diary");

    rows.forEach((row, i) => {
      if (i >= 20) return; // limit number of entries

      // Updated selectors
      const poster = row.querySelector("img.poster")?.src;
      const title = row.querySelector(".film-title")?.textContent?.trim();
      const year = row.querySelector(".film-title-year")?.textContent?.trim();
      const date = row.querySelector(".date")?.textContent?.trim();
      const ratingClass = row.querySelector(".rating")?.className || "";
      const hearted = row.querySelector(".icon-heart") ? true : false;
      const review = row.querySelector(".icon-review") ? true : false;
      const rewatch = row.querySelector(".icon-rewatch") ? true : false;

      let stars = "";
      const match = ratingClass.match(/rated-(\d+)/);
      if (match) {
        stars = "‚òÖ".repeat(parseInt(match[1]) / 2);
      }

      const entry = document.createElement("div");
      entry.className = "entry";

      entry.innerHTML = `
        <img class="poster" src="${poster || ''}">
        <div class="details">
          <div class="title">${title || "Untitled"}${year ? " ("+year+")" : ""}</div>
          <div class="meta">
            Watched ${date || "Unknown"} 
            ${rewatch ? "‚Ä¢ Rewatch" : ""}
            ${hearted ? "‚Ä¢ ‚ù§Ô∏è" : ""}
            ${review ? "‚Ä¢ üìù" : ""}
          </div>
          <div class="rating">${stars}</div>
        </div>
      `;

      container.appendChild(entry);
    });
  })
  .catch(err => {
    document.getElementById("diary").innerHTML = "<p style='color:white;'>Unable to load diary.</p>";
    console.error(err);
  });
</script>

</body>
</html>
