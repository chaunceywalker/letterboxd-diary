<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Letterboxd Diary</title>

<style>
body {
  margin:0;
  background:#14181c;
  font-family:-apple-system,BlinkMacSystemFont,sans-serif;
  color:white;
}

.container {
  padding:20px;
}

.entry {
  display:flex;
  gap:16px;
  padding:14px 0;
  border-bottom:1px solid #2c3440;
}

.poster {
  width:70px;
  border-radius:6px;
}

.details {
  flex:1;
}

.title {
  font-weight:600;
}

.meta {
  font-size:13px;
  color:#9ab;
  margin-top:4px;
}

.rating {
  color:#00e054;
  margin-top:6px;
  font-size:14px;
}
</style>
</head>

<body>
<div class="container" id="diary"></div>

<script>
const username = "chaunceywalker";

fetch(`https://corsproxy.io/?https://letterboxd.com/${username}/films/diary/`)
  .then(res => res.text())
  .then(html => {
    const parser = new DOMParser();
    const doc = parser.parseFromString(html, "text/html");
    const rows = doc.querySelectorAll(".diary-entry-row");

    const container = document.getElementById("diary");

    rows.forEach((row, i) => {
      if (i >= 20) return;

      const poster = row.querySelector(".film-poster img")?.src;
      const title = row.querySelector(".headline-3 a")?.textContent;
      const year = row.querySelector(".metadata a")?.textContent;
      const date = row.querySelector(".td-day a")?.textContent;
      const ratingClass = row.querySelector(".rating")?.className || "";
      const rewatch = row.innerHTML.includes("icon-rewatch");

      let stars = "";
      const match = ratingClass.match(/rated-(\d+)/);
      if (match) {
        stars = "★".repeat(parseInt(match[1]) / 2);
      }

      const entry = document.createElement("div");
      entry.className = "entry";

      entry.innerHTML = `
        <img class="poster" src="${poster}">
        <div class="details">
          <div class="title">${title} (${year})</div>
          <div class="meta">
            Watched ${date}
            ${rewatch ? " • Rewatch" : ""}
          </div>
          <div class="rating">${stars}</div>
        </div>
      `;

      container.appendChild(entry);
    });
  });
</script>

</body>
</html>
